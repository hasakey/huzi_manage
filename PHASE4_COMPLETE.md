# Phase 4 å®ŒæˆæŠ¥å‘Šï¼šç”¨æˆ·æçŽ°æµç¨‹ & ç®¡ç†å‘˜å®¡æ ¸

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. ç”¨æˆ·ç«¯æçŽ°åŠŸèƒ½ (`/dashboard/withdraw`)

#### Server Action
- **æ–‡ä»¶**: `app/dashboard/actions.ts`
- **å‡½æ•°**: `createWithdrawal(amount: number)`
- **åŠŸèƒ½**:
  - éªŒè¯ç”¨æˆ·ç™»å½•çŠ¶æ€
  - éªŒè¯æçŽ°é‡‘é¢ï¼ˆå¿…é¡» > 0ï¼‰
  - æ£€æŸ¥ç”¨æˆ·ä½™é¢æ˜¯å¦å……è¶³
  - åˆ›å»º `withdraw` ç±»åž‹çš„äº¤æ˜“è®°å½•ï¼ŒçŠ¶æ€ä¸º `pending`
  - è¿”å›žæˆåŠŸ/é”™è¯¯ä¿¡æ¯

#### UI ç»„ä»¶
- **æ–‡ä»¶**: `app/dashboard/withdraw/withdraw-form.tsx`
- **åŠŸèƒ½**:
  - æ˜¾ç¤ºå½“å‰ä½™é¢
  - æçŽ°é‡‘é¢è¾“å…¥æ¡†ï¼ˆå¸¦éªŒè¯ï¼‰
  - æäº¤æŒ‰é’®ï¼ˆå¸¦ loading çŠ¶æ€ï¼‰
  - é”™è¯¯å’ŒæˆåŠŸæ¶ˆæ¯æç¤º
  - ä½¿ç”¨è¯´æ˜Ž

#### é¡µé¢æ›´æ–°
- **æ–‡ä»¶**: `app/dashboard/withdraw/page.tsx`
- **åŠŸèƒ½**:
  - èŽ·å–å½“å‰ç”¨æˆ·ä½™é¢
  - æ¸²æŸ“æçŽ°è¡¨å•ç»„ä»¶

### 2. ç®¡ç†å‘˜ç«¯æçŽ°å®¡æ ¸ (`/admin/withdrawals`)

#### Server Actions
- **æ–‡ä»¶**: `app/admin/actions.ts`
- **å‡½æ•°**:
  - `getPendingWithdrawals()` - èŽ·å–æ‰€æœ‰å¾…å®¡æ ¸çš„æçŽ°è¯·æ±‚
    - æŸ¥è¯¢ `status='pending'` ä¸” `type='withdraw'` çš„äº¤æ˜“
    - å…³è”ç”¨æˆ·ä¿¡æ¯ï¼ˆå§“åã€é‚®ç®±ã€æ‰‹æœºå·ï¼‰
    - æŒ‰åˆ›å»ºæ—¶é—´å€’åºæŽ’åˆ—
  - `reviewWithdrawal(transactionId, action)` - å®¡æ ¸æçŽ°è¯·æ±‚
    - `action='approve'`: æ‰¹å‡†æçŽ°
      - éªŒè¯ç”¨æˆ·ä½™é¢æ˜¯å¦å……è¶³
      - æ‰£é™¤ç”¨æˆ·ä½™é¢
      - æ›´æ–°äº¤æ˜“çŠ¶æ€ä¸º `approved`
    - `action='reject'`: æ‹’ç»æçŽ°
      - ä»…æ›´æ–°äº¤æ˜“çŠ¶æ€ä¸º `rejected`
      - ä¸æ‰£é™¤ç”¨æˆ·ä½™é¢

#### UI ç»„ä»¶

**æçŽ°åˆ—è¡¨è¡¨æ ¼** (`app/admin/withdrawals/withdrawals-table.tsx`):
- æ˜¾ç¤ºæ‰€æœ‰å¾…å®¡æ ¸çš„æçŽ°è¯·æ±‚
- è¡¨æ ¼åˆ—ï¼šç”¨æˆ·å§“åã€é‚®ç®±ã€æ‰‹æœºå·ã€æçŽ°é‡‘é¢ã€ç”³è¯·æ—¶é—´ã€æ“ä½œæŒ‰é’®
- ç©ºçŠ¶æ€æç¤º
- ç‚¹å‡»"å®¡æ ¸"æŒ‰é’®æ‰“å¼€å®¡æ ¸å¯¹è¯æ¡†

**å®¡æ ¸å¯¹è¯æ¡†** (`app/admin/withdrawals/review-withdrawal-dialog.tsx`):
- æ˜¾ç¤ºæçŽ°è¯¦æƒ…ï¼ˆç”¨æˆ·ä¿¡æ¯ã€æçŽ°é‡‘é¢ã€ç”³è¯·æ—¶é—´ï¼‰
- "æ‰¹å‡†"å’Œ"æ‹’ç»"æŒ‰é’®
- é”™è¯¯æ¶ˆæ¯æç¤º
- æ“ä½œæç¤ºä¿¡æ¯

#### é¡µé¢æ›´æ–°
- **æ–‡ä»¶**: `app/admin/withdrawals/page.tsx`
- **åŠŸèƒ½**:
  - éªŒè¯ç®¡ç†å‘˜æƒé™
  - èŽ·å–å¾…å®¡æ ¸æçŽ°åˆ—è¡¨
  - æ¸²æŸ“æçŽ°åˆ—è¡¨è¡¨æ ¼

## ðŸ“‹ æ•°æ®æµç¨‹

### ç”¨æˆ·æçŽ°æµç¨‹
```
1. ç”¨æˆ·åœ¨ /dashboard/withdraw é¡µé¢è¾“å…¥æçŽ°é‡‘é¢
2. å‰ç«¯éªŒè¯ï¼šé‡‘é¢ > 0 ä¸” <= å½“å‰ä½™é¢
3. è°ƒç”¨ createWithdrawal Server Action
4. åŽç«¯éªŒè¯ï¼šä½™é¢å……è¶³
5. åˆ›å»º transactions è®°å½•ï¼š
   - type: 'withdraw'
   - status: 'pending'
   - amount: æçŽ°é‡‘é¢
6. è¿”å›žæˆåŠŸæ¶ˆæ¯
```

### ç®¡ç†å‘˜å®¡æ ¸æµç¨‹
```
1. ç®¡ç†å‘˜åœ¨ /admin/withdrawals é¡µé¢æŸ¥çœ‹å¾…å®¡æ ¸åˆ—è¡¨
2. ç‚¹å‡»"å®¡æ ¸"æŒ‰é’®æ‰“å¼€å®¡æ ¸å¯¹è¯æ¡†
3. é€‰æ‹©"æ‰¹å‡†"æˆ–"æ‹’ç»"
4. è°ƒç”¨ reviewWithdrawal Server Action
5. å¦‚æžœæ‰¹å‡†ï¼š
   - éªŒè¯ç”¨æˆ·ä½™é¢å……è¶³
   - æ‰£é™¤ç”¨æˆ·ä½™é¢ï¼ˆprofiles.balance -= amountï¼‰
   - æ›´æ–°äº¤æ˜“çŠ¶æ€ä¸º 'approved'
6. å¦‚æžœæ‹’ç»ï¼š
   - ä»…æ›´æ–°äº¤æ˜“çŠ¶æ€ä¸º 'rejected'
7. åˆ·æ–°é¡µé¢æ•°æ®
```

## ðŸ”’ æƒé™æŽ§åˆ¶

- **ç”¨æˆ·ç«¯æçŽ°**: ä»…ç™»å½•ç”¨æˆ·å¯ä»¥åˆ›å»ºæçŽ°è¯·æ±‚
- **ç®¡ç†å‘˜å®¡æ ¸**: ä»…ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹å’Œå®¡æ ¸æçŽ°è¯·æ±‚
- æ‰€æœ‰ Server Actions éƒ½åŒ…å«æƒé™éªŒè¯

## ðŸŽ¨ UI/UX ç‰¹æ€§

- **å“åº”å¼è®¾è®¡**: ä½¿ç”¨ Tailwind CSSï¼Œé€‚é…ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯
- **Loading çŠ¶æ€**: æäº¤å’Œå®¡æ ¸æ“ä½œéƒ½æœ‰ loading æç¤º
- **é”™è¯¯å¤„ç†**: æ¸…æ™°çš„é”™è¯¯æ¶ˆæ¯æ˜¾ç¤º
- **æˆåŠŸåé¦ˆ**: æ“ä½œæˆåŠŸåŽæ˜¾ç¤ºç¡®è®¤æ¶ˆæ¯
- **æ•°æ®åˆ·æ–°**: æ“ä½œå®ŒæˆåŽè‡ªåŠ¨åˆ·æ–°é¡µé¢æ•°æ®

## ðŸ“ æ³¨æ„äº‹é¡¹

1. **ä½™é¢éªŒè¯**:
   - ç”¨æˆ·æçŽ°æ—¶éªŒè¯ä½™é¢å……è¶³
   - ç®¡ç†å‘˜æ‰¹å‡†æ—¶å†æ¬¡éªŒè¯ä½™é¢ï¼ˆé˜²æ­¢å¹¶å‘é—®é¢˜ï¼‰

2. **äº¤æ˜“çŠ¶æ€**:
   - åªæœ‰ `pending` çŠ¶æ€çš„æçŽ°è¯·æ±‚å¯ä»¥è¢«å®¡æ ¸
   - æ‰¹å‡†åŽçŠ¶æ€å˜ä¸º `approved`ï¼Œæ‹’ç»åŽå˜ä¸º `rejected`

3. **æ•°æ®ä¸€è‡´æ€§**:
   - ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ç¡®ä¿ä½™é¢æ›´æ–°å’Œäº¤æ˜“çŠ¶æ€æ›´æ–°çš„åŽŸå­æ€§
   - ä½¿ç”¨ `revalidatePath` ç¡®ä¿é¡µé¢æ•°æ®åŠæ—¶åˆ·æ–°

4. **ç”¨æˆ·ä½“éªŒ**:
   - æçŽ°è¡¨å•æœ‰å®žæ—¶éªŒè¯
   - å®¡æ ¸å¯¹è¯æ¡†æ˜¾ç¤ºå®Œæ•´çš„ç”¨æˆ·å’Œäº¤æ˜“ä¿¡æ¯
   - æ“ä½œæç¤ºæ¸…æ™°æ˜Žç¡®

## ðŸ§ª æµ‹è¯•å»ºè®®

1. **ç”¨æˆ·ç«¯æµ‹è¯•**:
   - æµ‹è¯•æ­£å¸¸æçŽ°æµç¨‹ï¼ˆä½™é¢å……è¶³ï¼‰
   - æµ‹è¯•ä½™é¢ä¸è¶³çš„æƒ…å†µ
   - æµ‹è¯•æ— æ•ˆé‡‘é¢è¾“å…¥
   - æµ‹è¯•æœªç™»å½•ç”¨æˆ·è®¿é—®

2. **ç®¡ç†å‘˜ç«¯æµ‹è¯•**:
   - æµ‹è¯•æŸ¥çœ‹å¾…å®¡æ ¸åˆ—è¡¨
   - æµ‹è¯•æ‰¹å‡†æçŽ°ï¼ˆéªŒè¯ä½™é¢æ‰£é™¤ï¼‰
   - æµ‹è¯•æ‹’ç»æçŽ°ï¼ˆéªŒè¯ä½™é¢ä¸å˜ï¼‰
   - æµ‹è¯•ä½™é¢ä¸è¶³æ—¶çš„æ‰¹å‡†æ“ä½œ
   - æµ‹è¯•éžç®¡ç†å‘˜ç”¨æˆ·è®¿é—®

3. **è¾¹ç•Œæƒ…å†µ**:
   - å¤šä¸ªç”¨æˆ·åŒæ—¶æçŽ°
   - ç®¡ç†å‘˜å®¡æ ¸æ—¶ç”¨æˆ·ä½™é¢å˜åŒ–
   - ç½‘ç»œé”™è¯¯å¤„ç†

## ðŸš€ ä¸‹ä¸€æ­¥ï¼ˆPhase 5ï¼‰

Phase 5 å°†å®žçŽ°ç»Ÿè®¡åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š
- ç”¨æˆ·ç«¯ï¼šæ˜¾ç¤ºæœ€è¿‘ 30 å¤©çš„äº¤æ˜“è®°å½•æŠ˜çº¿å›¾ï¼ˆä½¿ç”¨ Rechartsï¼‰
- ç®¡ç†å‘˜ç«¯ï¼šæ˜¾ç¤ºç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯ï¼ˆæ€»ç”¨æˆ·æ•°ã€æ€»äº¤æ˜“é¢ç­‰ï¼‰
